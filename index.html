<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#6366f1">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="apple-mobile-web-app-title" content="Finance Tracker">
  <title>Finance Tracker</title>
  
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icon-192.png">
  
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/recharts@2.5.0/dist/Recharts.js"></script>
  
  <style>
    body {
      margin: 0;
      padding: 0;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', sans-serif;
      -webkit-font-smoothing: antialiased;
    }
    #root { min-height: 100vh; }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script type="text/babel">
    const { useState, useEffect } = React;
    const { LineChart, Line, XAxis, YAxis, Tooltip, ResponsiveContainer, PieChart: RePieChart, Pie, Cell } = Recharts;
    
    // Icons
    const PlusCircle = ({ className }) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="8" x2="12" y2="16"></line><line x1="8" y1="12" x2="16" y2="12"></line></svg>;
    const TrendingUp = ({ className }) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 6 13.5 15.5 8.5 10.5 1 18"></polyline><polyline points="17 6 23 6 23 12"></polyline></svg>;
    const TrendingDown = ({ className }) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 18 13.5 8.5 8.5 13.5 1 6"></polyline><polyline points="17 18 23 18 23 12"></polyline></svg>;
    const Wallet = ({ className }) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21 12V7H5a2 2 0 0 1 0-4h14v4"></path><path d="M3 5v14a2 2 0 0 0 2 2h16v-5"></path><path d="M18 12a2 2 0 0 0 0 4h4v-4Z"></path></svg>;
    const PieChartIcon = ({ className }) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M21.21 15.89A10 10 0 1 1 8 2.83"></path><path d="M22 12A10 10 0 0 0 12 2v10z"></path></svg>;
    const BarChart3 = ({ className }) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><path d="M3 3v18h18"></path><path d="M18 17V9"></path><path d="M13 17V5"></path><path d="M8 17v-3"></path></svg>;
    const RefreshCw = ({ className }) => <svg className={className} width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth="2"><polyline points="23 4 23 10 17 10"></polyline><polyline points="1 20 1 14 7 14"></polyline><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"></path></svg>;

    const formatCurrency = (amount) => {
      return new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', minimumFractionDigits: 2, maximumFractionDigits: 2 }).format(amount);
    };

    function FinanceTracker() {
      const [currentTab, setCurrentTab] = useState('networth');
      const [checkingData, setCheckingData] = useState({ balance: 0, transactions: [] });
      const [rothHoldings, setRothHoldings] = useState([]);
      const [rothBalance, setRothBalance] = useState(0);
      const [rothContributions, setRothContributions] = useState(0);
      const [k401Holdings, set401KHoldings] = useState([]);
      const [k401Balance, set401KBalance] = useState(0);
      const [k401Contributions, set401KContributions] = useState(0);
      const [stockPrices, setStockPrices] = useState({});
      const [loadingPrices, setLoadingPrices] = useState(false);

      useEffect(() => {
        loadAllData();
      }, []);

      useEffect(() => {
        if (currentTab === 'roth' || currentTab === '401k' || currentTab === 'networth') {
          fetchStockPrices();
        }
      }, [currentTab, rothHoldings, k401Holdings]);

      const loadAllData = async () => {
        await loadCheckingData();
        await loadRothData();
        await load401KData();
      };

      const loadCheckingData = async () => {
        try {
          const balanceResult = await window.storage.get('checking-balance');
          const balance = balanceResult ? parseFloat(balanceResult.value) : 0;
          const transactions = [];
          
          try {
            const transactionsResult = await window.storage.list('checking-tx:');
            if (transactionsResult?.keys) {
              for (const key of transactionsResult.keys) {
                const data = await window.storage.get(key);
                if (data?.value) transactions.push(JSON.parse(data.value));
              }
            }
          } catch (e) {}
          
          setCheckingData({ balance, transactions: transactions.sort((a, b) => new Date(b.date) - new Date(a.date)) });
        } catch (e) {}
      };

      const loadRothData = async () => {
        try {
          const balanceResult = await window.storage.get('roth-balance');
          const contributionsResult = await window.storage.get('roth-contributions');
          
          setRothBalance(balanceResult ? parseFloat(balanceResult.value) : 0);
          setRothContributions(contributionsResult ? parseFloat(contributionsResult.value) : 0);
          
          const holdings = [];
          try {
            const holdingsResult = await window.storage.list('roth-holding:');
            if (holdingsResult?.keys) {
              for (const key of holdingsResult.keys) {
                const data = await window.storage.get(key);
                if (data?.value) holdings.push(JSON.parse(data.value));
              }
            }
          } catch (e) {}
          
          setRothHoldings(holdings);
        } catch (e) {}
      };

      const load401KData = async () => {
        try {
          const balanceResult = await window.storage.get('401k-balance');
          const contributionsResult = await window.storage.get('401k-contributions');
          
          set401KBalance(balanceResult ? parseFloat(balanceResult.value) : 0);
          set401KContributions(contributionsResult ? parseFloat(contributionsResult.value) : 0);
          
          const holdings = [];
          try {
            const holdingsResult = await window.storage.list('401k-holding:');
            if (holdingsResult?.keys) {
              for (const key of holdingsResult.keys) {
                const data = await window.storage.get(key);
                if (data?.value) holdings.push(JSON.parse(data.value));
              }
            }
          } catch (e) {}
          
          set401KHoldings(holdings);
        } catch (e) {}
      };

      const fetchStockPrices = async () => {
        const allTickers = [...new Set([...rothHoldings.map(h => h.ticker), ...k401Holdings.map(h => h.ticker)])];
        if (allTickers.length === 0) return;

        setLoadingPrices(true);
        const prices = {};

        for (const ticker of allTickers) {
          try {
            const response = await fetch(`https://query1.finance.yahoo.com/v8/finance/chart/${ticker}`);
            const data = await response.json();
            if (data.chart?.result?.[0]?.meta?.regularMarketPrice) {
              prices[ticker] = data.chart.result[0].meta.regularMarketPrice;
            }
          } catch (error) {}
        }

        setStockPrices(prices);
        setLoadingPrices(false);
      };

      const calculateCheckingBalance = () => {
        const income = checkingData.transactions.filter(t => t.type === 'income').reduce((sum, t) => sum + t.amount, 0);
        const expenses = checkingData.transactions.filter(t => t.type === 'expense').reduce((sum, t) => sum + t.amount, 0);
        return checkingData.balance + income - expenses;
      };

      const calculatePortfolioValue = (holdings) => {
        return holdings.reduce((sum, holding) => {
          const price = stockPrices[holding.ticker] || holding.costBasis;
          return sum + (holding.shares * price);
        }, 0);
      };

      const calculateRothValue = () => rothBalance + calculatePortfolioValue(rothHoldings);
      const calculate401KValue = () => k401Balance + calculatePortfolioValue(k401Holdings);
      const getTotalNetWorth = () => calculateCheckingBalance() + calculateRothValue() + calculate401KValue();

      return (
        <div className="min-h-screen bg-gradient-to-br from-blue-50 to-indigo-100">
          <div className="bg-white shadow-md">
            <div className="max-w-6xl mx-auto px-4">
              <div className="flex gap-1">
                {[
                  { id: 'networth', label: 'Net Worth', icon: PieChartIcon },
                  { id: 'checking', label: 'Checking', icon: Wallet },
                  { id: 'roth', label: 'Roth IRA', icon: TrendingUp },
                  { id: '401k', label: '401K', icon: BarChart3 }
                ].map(tab => {
                  const Icon = tab.icon;
                  return (
                    <button
                      key={tab.id}
                      onClick={() => setCurrentTab(tab.id)}
                      className={`flex items-center gap-2 px-6 py-4 font-semibold transition ${
                        currentTab === tab.id ? 'text-indigo-600 border-b-2 border-indigo-600' : 'text-gray-600 hover:text-indigo-600'
                      }`}
                    >
                      <Icon className="w-5 h-5" />
                      {tab.label}
                    </button>
                  );
                })}
              </div>
            </div>
          </div>

          <div className="max-w-6xl mx-auto p-4">
            {currentTab === 'networth' && (
              <NetWorthTab 
                totalNetWorth={getTotalNetWorth()}
                checkingBalance={calculateCheckingBalance()}
                rothValue={calculateRothValue()}
                k401Value={calculate401KValue()}
                loadingPrices={loadingPrices}
                onRefresh={fetchStockPrices}
              />
            )}
            
            {currentTab === 'checking' && (
              <CheckingTab 
                data={checkingData}
                onUpdate={loadCheckingData}
                currentBalance={calculateCheckingBalance()}
              />
            )}
            
            {currentTab === 'roth' && (
              <RetirementTab 
                type="Roth IRA"
                holdings={rothHoldings}
                balance={rothBalance}
                contributions={rothContributions}
                onReload={loadRothData}
                stockPrices={stockPrices}
                loadingPrices={loadingPrices}
                onRefresh={fetchStockPrices}
                contributionLimit={7000}
              />
            )}
            
            {currentTab === '401k' && (
              <RetirementTab 
                type="401K"
                holdings={k401Holdings}
                balance={k401Balance}
                contributions={k401Contributions}
                onReload={load401KData}
                stockPrices={stockPrices}
                loadingPrices={loadingPrices}
                onRefresh={fetchStockPrices}
                contributionLimit={23000}
              />
            )}
          </div>
        </div>
      );
    }

    function NetWorthTab({ totalNetWorth, checkingBalance, rothValue, k401Value, loadingPrices, onRefresh }) {
      const accountData = [
        { name: 'Checking', value: checkingBalance, color: '#6366f1' },
        { name: 'Roth IRA', value: rothValue, color: '#8b5cf6' },
        { name: '401K', value: k401Value, color: '#ec4899' }
      ];

      return (
        <div className="space-y-6">
          <div className="bg-white rounded-2xl shadow-xl p-6">
            <div className="flex items-center justify-between mb-6">
              <div>
                <h2 className="text-gray-600 text-lg mb-2">Total Net Worth</h2>
                <p className="text-5xl font-bold text-gray-800">{formatCurrency(totalNetWorth)}</p>
              </div>
              <button onClick={onRefresh} disabled={loadingPrices} className="flex items-center gap-2 px-4 py-2 bg-indigo-600 text-white rounded-lg hover:bg-indigo-700 transition disabled:opacity-50">
                <RefreshCw className={`w-5 h-5 ${loadingPrices ? 'animate-spin' : ''}`} />
                Refresh
              </button>
            </div>

            <div className="grid grid-cols-3 gap-4 mb-6">
              <div className="bg-gradient-to-br from-indigo-500 to-indigo-600 rounded-xl p-6 text-white">
                <div className="flex items-center gap-2 mb-2"><Wallet className="w-5 h-5" /><p className="font-medium">Checking</p></div>
                <p className="text-3xl font-bold">{formatCurrency(checkingBalance)}</p>
              </div>
              <div className="bg-gradient-to-br from-purple-500 to-purple-600 rounded-xl p-6 text-white">
                <div className="flex items-center gap-2 mb-2"><TrendingUp className="w-5 h-5" /><p className="font-medium">Roth IRA</p></div>
                <p className="text-3xl font-bold">{formatCurrency(rothValue)}</p>
              </div>
              <div className="bg-gradient-to-br from-pink-500 to-pink-600 rounded-xl p-6 text-white">
                <div className="flex items-center gap-2 mb-2"><BarChart3 className="w-5 h-5" /><p className="font-medium">401K</p></div>
                <p className="text-3xl font-bold">{formatCurrency(k401Value)}</p>
              </div>
            </div>

            <div className="bg-gray-50 rounded-xl p-6">
              <h3 className="text-lg font-bold text-gray-800 mb-4">Asset Allocation</h3>
              <div className="flex items-center justify-center" style={{ height: '300px' }}>
                <ResponsiveContainer width="100%" height="100%">
                  <RePieChart>
                    <Pie data={accountData} dataKey="value" nameKey="name" cx="50%" cy="50%" outerRadius={100} label={({ name, percent }) => `${name} ${(percent * 100).toFixed(0)}%`}>
                      {accountData.map((entry, index) => <Cell key={index} fill={entry.color} />)}
                    </Pie>
                    <Tooltip formatter={(value) => formatCurrency(value)} />
                  </RePieChart>
                </ResponsiveContainer>
              </div>
            </div>
          </div>
        </div>
      );
    }

    function CheckingTab({ data, onUpdate, currentBalance }) {
      const [showForm, setShowForm] = useState(false);
      const [showStartingBalance, setShowStartingBalance] = useState(false);
      const [formData, setFormData] = useState({ type: 'expense', amount: '', category: '', description: '', date: new Date().toISOString().split('T')[0] });

      useEffect(() => {
        if (data.balance === 0 && data.transactions.length === 0) setShowStartingBalance(true);
      }, [data]);

      const saveStartingBalance = async (amount) => {
        try {
          await window.storage.set('checking-balance', amount.toString());
          setShowStartingBalance(false);
          onUpdate();
        } catch (error) {}
      };

      const handleSubmit = async () => {
        if (!formData.amount || !formData.category) return alert('Please fill in required fields');
        
        const newTransaction = { ...formData, amount: parseFloat(formData.amount), id: Date.now().toString(), timestamp: new Date().toISOString() };

        try {
          await window.storage.set(`checking-tx:${newTransaction.id}`, JSON.stringify(newTransaction));
          setFormData({ type: 'expense', amount: '', category: '', description: '', date: new Date().toISOString().split('T')[0] });
          setShowForm(false);
          onUpdate();
        } catch (error) {}
      };

      const deleteTransaction = async (id) => {
        try {
          await window.storage.delete(`checking-tx:${id}`);
          onUpdate();
        } catch (error) {}
      };

      const expenseCategories = ['Food', 'Transportation', 'Housing', 'Entertainment', 'Utilities', 'Healthcare', 'Shopping', 'Other'];
      const incomeCategories = ['Salary', 'Freelance', 'Investment', 'Gift', 'Other'];

      return (
        <div className="space-y-6">
          {showStartingBalance && (
            <div className="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4">
              <div className="bg-white rounded-2xl shadow-2xl max-w-md w-full p-6">
                <h2 className="text-2xl font-bold text-gray-800 mb-2">Set Starting Balance</h2>
                <p className="text-gray-600 mb-6">Enter your current checking account balance.</p>
                <input type="number" step="0.01" placeholder="Enter amount" className="w-full px-4 py-3 border-2 border-gray-300 rounded-lg mb-4" id="starting-balance-input" />
                <button onClick={() => { const input = document.getElementById('starting-balance-input'); if (input.value) saveStartingBalance(input.value); }} className="w-full bg-indigo-600 text-white py-3 rounded-lg font-semibold">Save</button>
              </div>
            </div>
          )}

          <div className="bg-white rounded-2xl shadow-xl overflow-hidden">
            <div className="bg-gradient-to-r from-indigo-600 to-purple-600 p-6 text-white">
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-3xl font-bold">Checking Account</h2>
                <button onClick={() => setShowForm(!showForm)} className="bg-white text-indigo-600 px-4 py-2 rounded-lg font-semibold flex items-center gap-2">
                  <PlusCircle className="w-5 h-5" />Add
                </button>
              </div>

              <div className="mb-4">
                <p className="text-sm opacity-90 mb-1">Current Balance</p>
                <p className="text-5xl font-bold">{formatCurrency(currentBalance)}</p>
              </div>

              <div className="grid grid-cols-2 gap-4">
                <div className="bg-white bg-opacity-20 backdrop-blur-sm rounded-lg p-4">
                  <p className="text-sm opacity-90 mb-1">Starting Balance</p>
                  <p className="text-2xl font-bold">{formatCurrency(data.balance)}</p>
                  <button onClick={() => setShowStartingBalance(true)} className="text-xs opacity-75 hover:opacity-100 mt-1">Edit</button>
                </div>
                <div className="bg-white bg-opacity-20 backdrop-blur-sm rounded-lg p-4">
                  <p className="text-sm opacity-90 mb-1">Transactions</p>
                  <p className="text-2xl font-bold">{data.transactions.length}</p>
                </div>
              </div>
            </div>

            {showForm && (
              <div className="p-6 bg-gray-50 border-b">
                <div className="space-y-4">
                  <div className="grid grid-cols-2 gap-4">
                    <div><label className="block text-sm font-medium mb-1">Type</label><select value={formData.type} onChange={(e) => setFormData({...formData, type: e.target.value})} className="w-full px-3 py-2 border rounded-lg"><option value="expense">Expense</option><option value="income">Income</option></select></div>
                    <div><label className="block text-sm font-medium mb-1">Amount</label><input type="number" step="0.01" value={formData.amount} onChange={(e) => setFormData({...formData, amount: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div>
                  </div>
                  <div><label className="block text-sm font-medium mb-1">Category</label><select value={formData.category} onChange={(e) => setFormData({...formData, category: e.target.value})} className="w-full px-3 py-2 border rounded-lg"><option value="">Select category</option>{(formData.type === 'expense' ? expenseCategories : incomeCategories).map(cat => <option key={cat} value={cat}>{cat}</option>)}</select></div>
                  <div><label className="block text-sm font-medium mb-1">Date</label><input type="date" value={formData.date} onChange={(e) => setFormData({...formData, date: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div>
                  <div><label className="block text-sm font-medium mb-1">Description</label><input type="text" value={formData.description} onChange={(e) => setFormData({...formData, description: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div>
                  <div className="flex gap-3">
                    <button onClick={handleSubmit} className="flex-1 bg-indigo-600 text-white py-2 rounded-lg font-semibold">Add Transaction</button>
                    <button onClick={() => setShowForm(false)} className="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg font-semibold">Cancel</button>
                  </div>
                </div>
              </div>
            )}

            <div className="p-6">
              <h3 className="text-xl font-bold mb-4">Transactions</h3>
              {data.transactions.length === 0 ? <p className="text-gray-500 text-center py-8">No transactions yet.</p> : (
                <div className="space-y-3">
                  {data.transactions.map(t => (
                    <div key={t.id} className="bg-white border rounded-lg p-4">
                      <div className="flex justify-between">
                        <div className="flex-1">
                          <div className="flex items-center gap-2 mb-1">
                            {t.type === 'income' ? <TrendingUp className="w-5 h-5 text-green-500" /> : <TrendingDown className="w-5 h-5 text-red-500" />}
                            <span className="font-semibold">{t.category}</span>
                          </div>
                          {t.description && <p className="text-sm text-gray-600 ml-7">{t.description}</p>}
                          <p className="text-xs text-gray-500 ml-7 mt-1">{new Date(t.date).toLocaleDateString()}</p>
                        </div>
                        <div className="text-right">
                          <p className={`text-xl font-bold ${t.type === 'income' ? 'text-green-600' : 'text-red-600'}`}>{t.type === 'income' ? '+' : '-'}{formatCurrency(t.amount)}</p>
                          <button onClick={() => deleteTransaction(t.id)} className="text-xs text-red-500 mt-1">Delete</button>
                        </div>
                      </div>
                    </div>
                  ))}
                </div>
              )}
            </div>
          </div>
        </div>
      );
    }

    function RetirementTab({ type, holdings, balance, contributions, onReload, stockPrices, loadingPrices, onRefresh, contributionLimit }) {
      const [showHoldingForm, setShowHoldingForm] = useState(false);
      const [holdingForm, setHoldingForm] = useState({ ticker: '', shares: '', costBasis: '' });

      const accountPrefix = type === 'Roth IRA' ? 'roth' : '401k';
      const portfolioValue = balance + holdings.reduce((sum, h) => (stockPrices[h.ticker] || h.costBasis) * h.shares + sum, 0);
      const contributionProgress = (contributions / contributionLimit) * 100;

      const handleSubmit = async () => {
        if (!holdingForm.ticker || !holdingForm.shares || !holdingForm.costBasis) return alert('Please fill in all fields');

        const newHolding = { ticker: holdingForm.ticker.toUpperCase().trim(), shares: parseFloat(holdingForm.shares), costBasis: parseFloat(holdingForm.costBasis), id: Date.now().toString(), timestamp: new Date().toISOString() };

        try {
          await window.storage.set(`${accountPrefix}-holding:${newHolding.id}`, JSON.stringify(newHolding));
          setHoldingForm({ ticker: '', shares: '', costBasis: '' });
          setShowHoldingForm(false);
          onReload();
        } catch (error) {}
      };

      const deleteHolding = async (id) => {
        try {
          await window.storage.delete(`${accountPrefix}-holding:${id}`);
          onReload();
        } catch (error) {}
      };

      return (
        <div className="space-y-6">
          <div className="bg-white rounded-2xl shadow-xl overflow-hidden">
            <div className="bg-gradient-to-r from-purple-600 to-pink-600 p-6 text-white">
              <div className="flex items-center justify-between mb-4">
                <h2 className="text-3xl font-bold">{type}</h2>
                <button onClick={onRefresh} disabled={loadingPrices} className="bg-white bg-opacity-20 px-4 py-2 rounded-lg flex items-center gap-2">
                  <RefreshCw className={`w-5 h-5 ${loadingPrices ? 'animate-spin' : ''}`} />Refresh
                </button>
              </div>

              <div className="mb-4">
                <p className="text-sm opacity-90 mb-1">Portfolio Value</p>
                <p className="text-5xl font-bold">{formatCurrency(portfolioValue)}</p>
              </div>

              {type === 'Roth IRA' && (
                <div className="bg-white bg-opacity-20 rounded-lg p-4 mb-4">
                  <div className="flex items-center justify-between mb-2">
                    <p className="text-sm font-medium">Annual Contributions</p>
                    <p className="text-sm font-bold">{formatCurrency(contributions)} / {formatCurrency(contributionLimit)}</p>
                  </div>
                  <div className="w-full bg-white bg-opacity-30 rounded-full h-3">
                    <div className="bg-white h-3 rounded-full" style={{ width: `${Math.min(contributionProgress, 100)}%` }} />
                  </div>
                  <p className="text-xs mt-1">{contributionProgress.toFixed(1)}% of limit</p>
                </div>
              )}

              <div className="grid grid-cols-2 gap-4">
                <div className="bg-white bg-opacity-20 rounded-lg p-4">
                  <p className="text-sm opacity-90 mb-1">Cash Balance</p>
                  <p className="text-2xl font-bold">{formatCurrency(balance)}</p>
                </div>
                <div className="bg-white bg-opacity-20 rounded-lg p-4">
                  <p className="text-sm opacity-90 mb-1">Holdings</p>
                  <p className="text-2xl font-bold">{holdings.length}</p>
                </div>
              </div>
            </div>

            <div className="p-6">
              <div className="flex items-center justify-between mb-4">
                <h3 className="text-xl font-bold">Holdings</h3>
                <button onClick={() => setShowHoldingForm(!showHoldingForm)} className="bg-indigo-600 text-white px-4 py-2 rounded-lg flex items-center gap-2">
                  <PlusCircle className="w-5 h-5" />Add Holding
                </button>
              </div>

              {showHoldingForm && (
                <div className="bg-gray-50 rounded-lg p-4 mb-4">
                  <div className="space-y-4">
                    <div className="grid grid-cols-3 gap-3">
                      <div><label className="block text-sm font-medium mb-1">Ticker</label><input type="text" placeholder="VTI" value={holdingForm.ticker} onChange={(e) => setHoldingForm({...holdingForm, ticker: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div>
                      <div><label className="block text-sm font-medium mb-1">Shares</label><input type="number" step="0.001" value={holdingForm.shares} onChange={(e) => setHoldingForm({...holdingForm, shares: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div>
                      <div><label className="block text-sm font-medium mb-1">Cost Basis</label><input type="number" step="0.01" value={holdingForm.costBasis} onChange={(e) => setHoldingForm({...holdingForm, costBasis: e.target.value})} className="w-full px-3 py-2 border rounded-lg" /></div>
                    </div>
                    <div className="flex gap-3">
                      <button onClick={handleSubmit} className="flex-1 bg-indigo-600 text-white py-2 rounded-lg font-semibold">Add Holding</button>
                      <button onClick={() => setShowHoldingForm(false)} className="flex-1 bg-gray-300 text-gray-700 py-2 rounded-lg font-semibold">Cancel</button>
                    </div>
                  </div>
                </div>
              )}

              {holdings.length === 0 ? <p className="text-gray-500 text-center py-8">No holdings yet.</p> : (
                <div className="overflow-x-auto">
                  <table className="w-full">
                    <thead><tr className="border-b"><th className="text-left py-3 px-2">Ticker</th><th className="text-right py-3 px-2">Shares</th><th className="text-right py-3 px-2">Cost Basis</th><th className="text-right py-3 px-2">Current Price</th><th className="text-right py-3 px-2">Value</th><th className="text-right py-3 px-2">Gain/Loss</th><th className="text-right py-3 px-2"></th></tr></thead>
                    <tbody>
                      {holdings.map(h => {
                        const currentPrice = stockPrices[h.ticker] || h.costBasis;
                        const value = h.shares * currentPrice;
                        const gainLoss = value - (h.shares * h.costBasis);
                        const gainLossPercent = (gainLoss / (h.shares * h.costBasis)) * 100;
                        return (
                          <tr key={h.id} className="border-b hover:bg-gray-50">
                            <td className="py-3 px-2 font-semibold">{h.ticker}</td>
                            <td className="py-3 px-2 text-right">{h.shares.toFixed(3)}</td>
                            <td className="py-3 px-2 text-right">{formatCurrency(h.costBasis)}</td>
                            <td className="py-3 px-2 text-right">{formatCurrency(currentPrice)}</td>
                            <td className="py-3 px-2 text-right font-semibold">{formatCurrency(value)}</td>
                            <td className={`py-3 px-2 text-right font-semibold ${gainLoss >= 0 ? 'text-green-600' : 'text-red-600'}`}>{gainLoss >= 0 ? '+' : ''}{formatCurrency(gainLoss)} ({gainLossPercent.toFixed(2)}%)</td>
                            <td className="py-3 px-2 text-right"><button onClick={() => deleteHolding(h.id)} className="text-xs text-red-500">Delete</button></td>
                          </tr>
                        );
                      })}
                    </tbody>
                  </table>
                </div>
              )}
            </div>
          </div>
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(<FinanceTracker />);
  </script>
  
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('sw.js').catch(() => {});
      });
    }
  </script>
</body>
</html>