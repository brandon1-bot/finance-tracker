<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <title>Finance Tracker</title>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body { 
      font-family: -apple-system, BlinkMacSystemFont, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
    }
    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }
    .nav { 
      background: white; 
      display: flex; 
      gap: 5px; 
      border-radius: 15px; 
      padding: 5px;
      margin-bottom: 20px;
      box-shadow: 0 4px 20px rgba(0,0,0,0.1);
    }
    .nav-btn {
      flex: 1; padding: 15px; border: none; background: transparent;
      cursor: pointer; border-radius: 10px; font-weight: 600;
      transition: all 0.3s; color: #666; font-size: 14px;
    }
    .nav-btn.active { background: linear-gradient(135deg, #667eea, #764ba2); color: white; }
    .card {
      background: white; border-radius: 20px; padding: 30px;
      box-shadow: 0 10px 40px rgba(0,0,0,0.1); margin-bottom: 20px;
    }
    .balance { font-size: 48px; font-weight: bold; color: #333; margin: 20px 0; }
    .account-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: 20px; margin: 20px 0; }
    .account-card { padding: 25px; border-radius: 15px; color: white; }
    .checking { background: linear-gradient(135deg, #667eea, #764ba2); }
    .roth { background: linear-gradient(135deg, #f093fb, #f5576c); }
    .k401 { background: linear-gradient(135deg, #4facfe, #00f2fe); }
    .account-card .amount { font-size: 32px; font-weight: bold; margin-top: 10px; }
    .btn {
      background: linear-gradient(135deg, #667eea, #764ba2); color: white;
      border: none; padding: 15px 30px; border-radius: 10px;
      font-size: 16px; font-weight: 600; cursor: pointer; margin: 5px;
    }
    .btn:hover { transform: translateY(-2px); }
    .btn-secondary { background: #ddd; color: #333; }
    .form-group { margin-bottom: 15px; }
    .form-group label { display: block; margin-bottom: 5px; font-weight: 600; }
    .form-group input, .form-group select {
      width: 100%; padding: 12px; border: 2px solid #e0e0e0;
      border-radius: 8px; font-size: 16px;
    }
    .transaction {
      background: #f8f9fa; padding: 15px; border-radius: 10px;
      margin-bottom: 10px; display: flex; justify-content: space-between;
    }
    .transaction.income { border-left: 4px solid #4caf50; }
    .transaction.expense { border-left: 4px solid #f44336; }
    .amount-green { color: #4caf50; font-weight: bold; font-size: 20px; }
    .amount-red { color: #f44336; font-weight: bold; font-size: 20px; }
    .modal {
      position: fixed; top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.5); display: flex; align-items: center;
      justify-content: center; padding: 20px; z-index: 1000;
    }
    .modal-content {
      background: white; border-radius: 20px; padding: 30px;
      max-width: 500px; width: 100%; max-height: 90vh; overflow-y: auto;
    }
    table { width: 100%; border-collapse: collapse; font-size: 14px; }
    th, td { padding: 12px 8px; text-align: left; }
    th { border-bottom: 2px solid #ddd; }
    td { border-bottom: 1px solid #eee; }
    .delete-btn { color: #f44336; cursor: pointer; font-size: 12px; }
    .delete-btn:hover { text-decoration: underline; }
    @media (max-width: 768px) {
      .balance { font-size: 36px; }
      .nav-btn { padding: 10px; font-size: 12px; }
    }
  </style>
</head>
<body>
  <div id="root"></div>
  
  <script>
    const { useState, useEffect, createElement: h } = React;
    const fmt = (n) => '$' + n.toLocaleString('en-US', {minimumFractionDigits: 2, maximumFractionDigits: 2});
    
    function App() {
      const [tab, setTab] = useState('networth');
      const [checkBal, setCheckBal] = useState(0);
      const [checkTx, setCheckTx] = useState([]);
      const [rothHold, setRothHold] = useState([]);
      const [rothBal, setRothBal] = useState(0);
      const [k401Hold, set401Hold] = useState([]);
      const [k401Bal, set401Bal] = useState(0);
      const [prices, setPrices] = useState({});
      const [showModal, setShowModal] = useState(null);
      const [formData, setFormData] = useState({});
      
      useEffect(() => {
        const cb = localStorage.getItem('checkBal');
        const ct = localStorage.getItem('checkTx');
        const rb = localStorage.getItem('rothBal');
        const rh = localStorage.getItem('rothHold');
        const kb = localStorage.getItem('k401Bal');
        const kh = localStorage.getItem('k401Hold');
        if (cb) setCheckBal(parseFloat(cb));
        if (ct) setCheckTx(JSON.parse(ct));
        if (rb) setRothBal(parseFloat(rb));
        if (rh) setRothHold(JSON.parse(rh));
        if (kb) set401Bal(parseFloat(kb));
        if (kh) set401Hold(JSON.parse(kh));
      }, []);
      
      const saveCheck = (bal, tx) => {
        setCheckBal(bal);
        setCheckTx(tx);
        localStorage.setItem('checkBal', bal);
        localStorage.setItem('checkTx', JSON.stringify(tx));
      };
      
      const saveRoth = (bal, hold) => {
        setRothBal(bal);
        setRothHold(hold);
        localStorage.setItem('rothBal', bal);
        localStorage.setItem('rothHold', JSON.stringify(hold));
      };
      
      const save401 = (bal, hold) => {
        set401Bal(bal);
        set401Hold(hold);
        localStorage.setItem('k401Bal', bal);
        localStorage.setItem('k401Hold', JSON.stringify(hold));
      };
      
      const fetchPrices = async () => {
        const tickers = [...new Set([...rothHold.map(h => h.ticker), ...k401Hold.map(h => h.ticker)])];
        if (tickers.length === 0) return;
        const p = {};
        for (const t of tickers) {
          try {
            const r = await fetch(`https://query1.finance.yahoo.com/v8/finance/chart/${t}`);
            const d = await r.json();
            if (d.chart?.result?.[0]?.meta?.regularMarketPrice) {
              p[t] = d.chart.result[0].meta.regularMarketPrice;
            }
          } catch(e) {}
        }
        setPrices(p);
      };
      
      const calcCheck = () => {
        const inc = checkTx.filter(t => t.type === 'income').reduce((s, t) => s + t.amount, 0);
        const exp = checkTx.filter(t => t.type === 'expense').reduce((s, t) => s + t.amount, 0);
        return checkBal + inc - exp;
      };
      
      const calcPort = (holds) => holds.reduce((s, h) => s + h.shares * (prices[h.ticker] || h.cost), 0);
      const rothVal = rothBal + calcPort(rothHold);
      const k401Val = k401Bal + calcPort(k401Hold);
      const netWorth = calcCheck() + rothVal + k401Val;
      
      const addTx = () => {
        if (!formData.amount || !formData.category) return alert('Fill all fields');
        const tx = {...formData, amount: parseFloat(formData.amount), id: Date.now()};
        saveCheck(checkBal, [tx, ...checkTx]);
        setShowModal(null);
        setFormData({});
      };
      
      const addHold = (isRoth) => {
        if (!formData.ticker || !formData.shares || !formData.cost) return alert('Fill all fields');
        const h = {ticker: formData.ticker.toUpperCase(), shares: parseFloat(formData.shares), cost: parseFloat(formData.cost), id: Date.now()};
        if (isRoth) saveRoth(rothBal, [...rothHold, h]);
        else save401(k401Bal, [...k401Hold, h]);
        setShowModal(null);
        setFormData({});
      };
      
      return h('div', {className: 'container'},
        h('div', {className: 'nav'},
          ['ðŸ’° Net Worth', 'ðŸ¦ Checking', 'ðŸ“ˆ Roth IRA', 'ðŸ’¼ 401K'].map((label, i) =>
            h('button', {
              key: i,
              className: 'nav-btn' + (tab === ['networth','checking','roth','k401'][i] ? ' active' : ''),
              onClick: () => setTab(['networth','checking','roth','k401'][i])
            }, label)
          )
        ),
        
        tab === 'networth' && h('div', null,
          h('div', {className: 'card'},
            h('h2', null, 'Total Net Worth'),
            h('div', {className: 'balance'}, fmt(netWorth)),
            h('button', {className: 'btn', onClick: fetchPrices}, 'ðŸ”„ Refresh Prices')
          ),
          h('div', {className: 'account-grid'},
            h('div', {className: 'account-card checking'},
              h('div', null, 'Checking'),
              h('div', {className: 'amount'}, fmt(calcCheck()))
            ),
            h('div', {className: 'account-card roth'},
              h('div', null, 'Roth IRA'),
              h('div', {className: 'amount'}, fmt(rothVal))
            ),
            h('div', {className: 'account-card k401'},
              h('div', null, '401K'),
              h('div', {className: 'amount'}, fmt(k401Val))
            )
          )
        ),
        
        tab === 'checking' && h('div', null,
          h('div', {className: 'card'},
            h('h2', null, 'Checking Account'),
            h('div', {className: 'balance'}, fmt(calcCheck())),
            h('div', null,
              h('button', {className: 'btn', onClick: () => setShowModal('checkBal')}, 'Set Balance'),
              h('button', {className: 'btn', onClick: () => setShowModal('addTx')}, '+ Add Transaction')
            ),
            h('p', {style: {marginTop: '20px'}}, 'Starting Balance: ' + fmt(checkBal) + ' | Transactions: ' + checkTx.length)
          ),
          h('div', {className: 'card'},
            h('h3', null, 'Transactions'),
            checkTx.length === 0 ? h('p', {style: {color: '#999', textAlign: 'center', padding: '20px'}}, 'No transactions yet') :
            checkTx.map(t => h('div', {key: t.id, className: 'transaction ' + t.type},
              h('div', null,
                h('strong', null, t.category),
                t.description && h('div', {style: {fontSize: '14px', color: '#666'}}, t.description),
                h('div', {style: {fontSize: '12px', color: '#999'}}, t.date)
              ),
              h('div', null,
                h('div', {className: t.type === 'income' ? 'amount-green' : 'amount-red'}, 
                  (t.type === 'income' ? '+' : '-') + fmt(t.amount)
                ),
                h('span', {className: 'delete-btn', onClick: () => saveCheck(checkBal, checkTx.filter(x => x.id !== t.id))}, 'Delete')
              )
            ))
          )
        ),
        
        tab === 'roth' && h('div', {className: 'card'},
          h('h2', null, 'Roth IRA'),
          h('div', {className: 'balance'}, fmt(rothVal)),
          h('div', null,
            h('button', {className: 'btn', onClick: () => setShowModal('rothBal')}, 'Set Cash'),
            h('button', {className: 'btn', onClick: () => setShowModal('rothHold')}, '+ Add Holding'),
            h('button', {className: 'btn', onClick: fetchPrices}, 'ðŸ”„ Refresh')
          ),
          h('p', {style: {marginTop: '20px'}}, 'Cash: ' + fmt(rothBal) + ' | Holdings: ' + rothHold.length),
          rothHold.length > 0 && h('table', {style: {marginTop: '20px'}},
            h('thead', null, h('tr', null,
              h('th', null, 'Ticker'), h('th', null, 'Shares'), h('th', null, 'Cost'), 
              h('th', null, 'Price'), h('th', null, 'Value'), h('th', null, 'Gain/Loss'), h('th', null, '')
            )),
            h('tbody', null, rothHold.map(hold => {
              const price = prices[hold.ticker] || hold.cost;
              const val = hold.shares * price;
              const gain = val - (hold.shares * hold.cost);
              const pct = (gain / (hold.shares * hold.cost)) * 100;
              return h('tr', {key: hold.id},
                h('td', null, h('strong', null, hold.ticker)),
                h('td', null, hold.shares.toFixed(3)),
                h('td', null, fmt(hold.cost)),
                h('td', null, fmt(price)),
                h('td', null, h('strong', null, fmt(val))),
                h('td', {style: {color: gain >= 0 ? '#4caf50' : '#f44336'}}, 
                  (gain >= 0 ? '+' : '') + fmt(gain) + ' (' + pct.toFixed(1) + '%)'
                ),
                h('td', null, h('span', {className: 'delete-btn', onClick: () => saveRoth(rothBal, rothHold.filter(x => x.id !== hold.id))}, 'Del'))
              );
            }))
          )
        ),
        
        tab === 'k401' && h('div', {className: 'card'},
          h('h2', null, '401K'),
          h('div', {className: 'balance'}, fmt(k401Val)),
          h('div', null,
            h('button', {className: 'btn', onClick: () => setShowModal('k401Bal')}, 'Set Cash'),
            h('button', {className: 'btn', onClick: () => setShowModal('k401Hold')}, '+ Add Holding'),
            h('button', {className: 'btn', onClick: fetchPrices}, 'ðŸ”„ Refresh')
          ),
          h('p', {style: {marginTop: '20px'}}, 'Cash: ' + fmt(k401Bal) + ' | Holdings: ' + k401Hold.length),
          k401Hold.length > 0 && h('table', {style: {marginTop: '20px'}},
            h('thead', null, h('tr', null,
              h('th', null, 'Ticker'), h('th', null, 'Shares'), h('th', null, 'Cost'), 
              h('th', null, 'Price'), h('th', null, 'Value'), h('th', null, 'Gain/Loss'), h('th', null, '')
            )),
            h('tbody', null, k401Hold.map(hold => {
              const price = prices[hold.ticker] || hold.cost;
              const val = hold.shares * price;
              const gain = val - (hold.shares * hold.cost);
              const pct = (gain / (hold.shares * hold.cost)) * 100;
              return h('tr', {key: hold.id},
                h('td', null, h('strong', null, hold.ticker)),
                h('td', null, hold.shares.toFixed(3)),
                h('td', null, fmt(hold.cost)),
                h('td', null, fmt(price)),
                h('td', null, h('strong', null, fmt(val))),
                h('td', {style: {color: gain >= 0 ? '#4caf50' : '#f44336'}}, 
                  (gain >= 0 ? '+' : '') + fmt(gain) + ' (' + pct.toFixed(1) + '%)'
                ),
                h('td', null, h('span', {className: 'delete-btn', onClick: () => save401(k401Bal, k401Hold.filter(x => x.id !== hold.id))}, 'Del'))
              );
            }))
          )
        ),
        
        showModal && h('div', {className: 'modal', onClick: () => setShowModal(null)},
          h('div', {className: 'modal-content', onClick: e => e.stopPropagation()},
            showModal === 'checkBal' && h('div', null,
              h('h2', null, 'Set Starting Balance'),
              h('div', {className: 'form-group'},
                h('label', null, 'Amount'),
                h('input', {type: 'number', step: '0.01', placeholder: '0.00', onBlur: e => saveCheck(parseFloat(e.target.value) || 0, checkTx)})
              ),
              h('button', {className: 'btn', onClick: () => setShowModal(null)}, 'Done')
            ),
            
            showModal === 'addTx' && h('div', null,
              h('h2', null, 'Add Transaction'),
              h('div', {className: 'form-group'},
                h('label', null, 'Type'),
                h('select', {onChange: e => setFormData({...formData, type: e.target.value})},
                  h('option', {value: 'expense'}, 'Expense'),
                  h('option', {value: 'income'}, 'Income')
                )
              ),
              h('div', {className: 'form-group'},
                h('label', null, 'Amount'),
                h('input', {type: 'number', step: '0.01', placeholder: '0.00', onChange: e => setFormData({...formData, amount: e.target.value})})
              ),
              h('div', {className: 'form-group'},
                h('label', null, 'Category'),
                h('select', {onChange: e => setFormData({...formData, category: e.target.value})},
                  h('option', {value: ''}, 'Select...'),
                  ['Food','Transportation','Housing','Entertainment','Shopping','Other'].map(c => h('option', {key: c, value: c}, c))
                )
              ),
              h('div', {className: 'form-group'},
                h('label', null, 'Description'),
                h('input', {type: 'text', onChange: e => setFormData({...formData, description: e.target.value})})
              ),
              h('div', {className: 'form-group'},
                h('label', null, 'Date'),
                h('input', {type: 'date', defaultValue: new Date().toISOString().split('T')[0], onChange: e => setFormData({...formData, date: e.target.value})})
              ),
              h('button', {className: 'btn', onClick: addTx}, 'Add'),
              h('button', {className: 'btn btn-secondary', onClick: () => setShowModal(null)}, 'Cancel')
            ),
            
            (showModal === 'rothBal' || showModal === 'k401Bal') && h('div', null,
              h('h2', null, 'Set Cash Balance'),
              h('div', {className: 'form-group'},
                h('label', null, 'Amount'),
                h('input', {type: 'number', step: '0.01', placeholder: '0.00', onBlur: e => {
                  if (showModal === 'rothBal') saveRoth(parseFloat(e.target.value) || 0, rothHold);
                  else save401(parseFloat(e.target.value) || 0, k401Hold);
                }})
              ),
              h('button', {className: 'btn', onClick: () => setShowModal(null)}, 'Done')
            ),
            
            (showModal === 'rothHold' || showModal === 'k401Hold') && h('div', null,
              h('h2', null, 'Add Holding'),
              h('div', {className: 'form-group'},
                h('label', null, 'Ticker'),
                h('input', {type: 'text', placeholder: 'VTI', onChange: e => setFormData({...formData, ticker: e.target.value})})
              ),
              h('div', {className: 'form-group'},
                h('label', null, 'Shares'),
                h('input', {type: 'number', step: '0.001', placeholder: '10', onChange: e => setFormData({...formData, shares: e.target.value})})
              ),
              h('div', {className: 'form-group'},
                h('label', null, 'Cost Basis'),
                h('input', {type: 'number', step: '0.01', placeholder: '250.00', onChange: e => setFormData({...formData, cost: e.target.value})})
              ),
              h('button', {className: 'btn', onClick: () => addHold(showModal === 'rothHold')}, 'Add'),
              h('button', {className: 'btn btn-secondary', onClick: () => setShowModal(null)}, 'Cancel')
            )
          )
        )
      );
    }
    
    const root = ReactDOM.createRoot(document.getElementById('root'));
    root.render(React.createElement(App));
  </script>
</body>
</html>